# zsh configuration file
export HISTFILE=$HOME/.zsh_history
export HISTSIZE=10000
export SAVEHIST=10000

# Force English messages in terminal
export LANG=en_US.UTF-8
export LC_MESSAGES=en_US.UTF-8

# eza color scheme
export LS_COLORS="$LS_COLORS:di=36"

setopt APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_REDUCE_BLANKS
setopt EXTENDED_HISTORY

# alias for zsh
alias vim='nvim'
alias g='cd $(ghq list -p | fzf)'
alias vlast='vim "$(ls -1 | tail -n 1)"'

# alis for isucon
alias m='make'
alias ma='m before-bench && sleep 5 && ((m sql-all;) & m bench) && m after-bench; '
alias slackcat='cat'

{{ if eq .chezmoi.os "linux" }}
# ls command
command -v eza &> /dev/null && alias ls='eza --icons --group --git --group-directories-first' || alias ls='ls --color=auto --group-directories-first -h'

# global claude
alias claude="$HOME/.claude/local/claude"
{{ end }}

# Atuin: modern shell history tool
if [ -f "$HOME/.atuin/bin/env" ]; then
  . "$HOME/.atuin/bin/env"
fi

# zsh plugin
command -v sheldon >/dev/null 2>&1 && eval "$(sheldon source)"
command -v starship >/dev/null 2>&1 && eval "$(starship init zsh)"
command -v atuin >/dev/null 2>&1 && eval "$(atuin init zsh)"

# fzf integration
# if (( $+commands[fzf] )); then
#   source <(fzf --zsh)
# fi

# setup when compinit is available
if type compinit >/dev/null 2>&1; then
  autoload -Uz compinit
  compinit -C
fi

# SSH shortcut with fzf
function sshf() {
  # Listing Host and HostName from ~/.ssh/config and selecting with fzf
  local selection=$(grep -E "^\s*(Host|HostName) " ~/.ssh/config | \
    sed -E 's/^\s*Host(Name)?[ ]*//g' | \
    awk '{print $1}' | \
    grep -v '^HostName$' | \
    grep -v '\*' | \
    sort -u | \
    fzf --prompt="Select Host or HostName: ")

  # If a selection was made, initiate SSH connection
  if [ -n "$selection" ]; then
    ssh "$@""$selection"
  fi
}

